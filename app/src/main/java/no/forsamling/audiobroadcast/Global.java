package no.royalone.audiobroadcast;

import android.annotation.SuppressLint;
import android.content.Context;
import android.media.AudioFormat;
import android.media.AudioManager;
import android.net.wifi.WifiManager;
import android.os.Build;
import android.util.Log;

import no.royalone.audiobroadcast.controller.ClientDetails;
import no.royalone.audiobroadcast.controller.Playback;
import no.royalone.audiobroadcast.controller.Server;
import no.royalone.audiobroadcast.services.UPnPAudioService;

import org.teleal.cling.model.meta.Icon;
import org.teleal.cling.model.types.UDN;

import java.net.Inet4Address;
import java.net.InetAddress;
import java.net.NetworkInterface;
import java.net.SocketException;
import java.net.URI;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.List;

/**
 * Created by royal on 8/5/2018.
 */

//http://4thline.org/projects/cling/core/manual/cling-core-manual.xhtml
public class Global {

  public static Server _server;
  public static Playback _playback;
  public static final int DEFAULT_PORT = 4000;
  public static int  PERMISSION_REQUEST_READ_PHONE_STATE  = 100;

  public static UPnPAudioService audioService;
  public static Icon getDeviceIcon() {
    return new Icon("image/png", 48, 48, 8, URI.create("icon.png"), "89504E470D0A1A0A0000000D494844520000002D000000300803000000B28C03ED0000001974455874536F6674776172650041646F626520496D616765526561647971C9653C00000300504C5445EEF2DBAAAAABF5F5F5EEEEF2D1DDBABCC99DCBD2CBC5D0AB88888AFCFCFCD6E6B1CEDAB0BEC9A1F1F1F1F1F5DCDCEAB6D6E2B6D9E4BAB5C78DEAEECCDAE5BCB3BA95D6E1B8DDEEB9C4CCBDB2B3B3CDD9BAE6EEC2F6F6F8D9EAADDBDDE2EEF3E1C4CEABA4A3A5CDD9AED1D1D1CDDDA9DDECB6D4E3B1DDEDB1656466FAFAFABCBCBCC9D9A6D2DDB5D8E6B4CDDAC2D8E2B9D5DADB899A6BD9DADD9BA684DAEAB0D5E7AACBD6C4F8F8F8C6D2A7EAEDD1CED3D0E8E8E9D4D7D9E6E6E6BFCD9ECAD6ADD5E7ADE2EEBDC6D5A2ECEFD59EA47DDBE9B6CFDCADABB594DAECAF7B8D60D1DEC3A6AB81D6E2BEBBCE91B3C696C3C2C3C9C9CAC1CEA1E4E4E9D9E5B6D6E3B4D1D6D4C9D4A9C6CDC1E3F0BCB9C197D2D9D5D1E1AAC7CDC5C9DC9FC6D89DD7E9ADB1B78DE2EEBAE3E3E3D9D8D8EEF1D7D5D5D5A2B28DB9C19AD2E1AE595959C1BFC2E5E6ECCDDEA6C8D3AACAD7A4A2A593D4E0B4FAFAFCB1AFB2D1CED3DEE0E6C5CBC2C9D5BAD4DFB5DEF0B6DFECB7D3E0BED2E0B9CCCCCD464547EDEDEDD3DEB4DAE8B5D5E0B6D3E4AAD1E2A6D4D2D5D1DDB1E2F2B9C9D3ADD6E1B6CBDAAFC7D0C2C0CBA4D1DCB2B9C29EC8D8A3D4E2AFD3DFB1C5D2A2A7A89DE9E9EFE5F0C0E1E2E9E0EFB5DAEBB5D8E6B2CBDBA7CCD7ADC7D7A5C4CFA6C2CAA0BDC69FBBC69DE5F3BEE4F2BBDDDDDDD7E5B4D8E4B5CFDBB1DAE6B7FFFFFED2DDB3D8D8D7F9F9F9D9E7B5FEFEFDC1D0A7CECACFE0EFBAA0A67FF3F3F6DEEFB0BFCABAD8D4DBD5E1B4AFC08D727173AFC396D9E3BCCBD8AACED9AAD3E0B2D0DFACC2D1A1CDCBD0A1A0A2CFE0A9D7E3B6FBFCFDFBFBFBFDFDFDA5AD90D1D0D49B9F8FD6E1C1B6CA94E0F0B5B7C397677A51EBEDD4EBEED2C0D392C8CDC7C2D29EB5C2A5BCC6A4D8EAAADBECB3DCEAB3DCDBDEE0E1E6D3DFB3CFDDB6AFABB2C1CEA6E3F4BBA8BB84E1E3EDCCD8B4A4B782D3E6B1A9B086ACB28A3E3D3FBAC79B5F6E4ED3DDB1F0EFF4E6EEC8ECEEF8CBCACEE7EFC4CCD0CD90A473EAEFCECCD6AAE1EDBAE0EEBAE2EFB8A2A39AA6A5A7A1A68AADAFA6A7AE89A7AC83E9F5C0D9E8B3FEFEFEFFFFFFF96070A50000043A4944415478DA62F84F0A60C022F6AFB0B0F02871AA0FBFB97839CD38CD7D73E846B8EE7F38546B3E30F07B74FF85A7E7D90FDB7618BC81A9FE8755F5E428AF36DFD85843434F4F5F8F53265E72475095A3A89EAA375D7CE1E9B838A10BBEBE57E34CEF557845C9E0545D5276AD627DC4823FBB5959CF6CCB5BB8202242DC2B14453992EAEC32AE6BD3BEB64DF9C8C00702291FA744447CF10AE5C4AA5AA66B2F97FAB4699BDE3933C88301C3F97711EB55F54A900C47A8B661CF70708897DDF4EEBC3303583D83F3C7880AF1E9661BB1A89691D8A592D36C2AEB3145D8D2398501049C85A779C44F9792438439038C715321CCA9AFD9D4D4E3EB9477C2E79D53529CCF59BEDBE461DAF4D8EA30DC70B8EAD03976817D394DA626AA898ED2D2AF853F9EB7144E549775C83968F60A6E384CF5D18B779FDB39CD3CD864725DB5F2F3E7C4C408474747759378879CBECE6CB06A64979897769F619DD837339AEBEF75FE4A0850353171689E79296C2A72AA02AB9691E039C31AE8A4BD576DC66A5757FE4AD5CA4A7E5793C7D12A7D766B4B305C2253CA7366BEDDC4896EFD5CBAAB1B5C41A0E12F57B4CACC3ED6BB25182E3912D33D9F676EA0859B1A97AEEEEAD50D0D0DAB57EBF6ABA8CC746265C774F77FAB39DD732C2C3EB94D080959AC0B04AB1B7467F4CFD49EBD8F558219D9251020C7CE6E616F3F8BBB756BC892E0E065CB96E9EACE5053D19E1DD8CDB60A39BC218059A23DD75E4989BB75C2D6254B80EA83972CE652CBE8DC65C16E84129710B0C6AADD7E9612F7D29E5B5B05040E01C19210B53DAD4B95ECBB400EF977142D554D9678C80D54BCA2BE00A81AA43E64EBAD97DC9D5D06CBB1A9FE6F23B114A4B8BCBC430064BA804041797DCF6DAB8D48191949B5F9FBA5F540B58D8D1D62026240E31B1B1BABABD926E3C83BFF9963741AC5C404F4050EE9EBEB83B058355B094A1981928BB3BBAAC5808A0461C0C7CAE8286ED5FFE56258C40405452060A74F958DE67F3CAA35ADA458C4F47742D4FA9CB462C65FB205850395030DDF0934B8AACA660D7ED532A50FCB410EDFA9AF5FC5221544A8D47CCFCEDDA323A62FD658DFF330FC1521D53657D8EDB997AEE8E1569A951B6E4E48B5512FCF9CDCB0B0B05C0BF6EEF0A328C53116D572A2E9F3E602010FCFBCDED2E5F06C80CB6C7751D1C8C833914020FA9E60DD607DECD7D30408703722A8FAE84F970DDEBF41E049FE2282AA97677DFBE1E2E2B2C1C5F8048732E15A4AAB48EBE7A4FC499314393289507D2093F1EDF1962DFB19356A93D103105375D1330DC6FDC5EBB214336B935769721EC5A3FADFD155C91ADBEF146F29F657D4E048B6DEB88A13A7EA7F4739CDEB8C18398A5A8C6E047CE7D0AA49E235C7A75A93C95AD99FF100A36411E37749FF54EB8D9AF8541F61AA4B52F697BCC3C858A415906ACB2B73E41FEE30F9C7B98AA9CE7691724D408D726A9235AF0C9A27317CA969CEC46B9B9494646BBD9169D511F49604408001003EE42959E2CD74A60000000049454E44AE426082");
  }

  public static String getDeviceBrand(){
    StringBuilder sb = new StringBuilder();
    if (!Build.MODEL.toLowerCase().startsWith(Build.MANUFACTURER.toLowerCase())) {
      sb.append(Build.MANUFACTURER);
      sb.append(" ");
    }
    sb.append(Build.MODEL);
    return sb.toString();
  }


  /**
   * Get the method name for a depth in call stack. <br />
   * Utility function
   * @param depth depth in the call stack (0 means current method, 1 means call method, ...)
   * @return method name
   */
  public static String getMethodName(final int depth) {
    final StackTraceElement[] ste = Thread.currentThread().getStackTrace();
    return "***************" + ste[ste.length - 1 - depth].getMethodName() + "*****************";
  }

  public static String getServerIP() {
    try {
      Enumeration<NetworkInterface> en = NetworkInterface.getNetworkInterfaces();
      while (en.hasMoreElements()) {
        Enumeration<InetAddress> enumIpAddr = ((NetworkInterface) en.nextElement()).getInetAddresses();
        while (enumIpAddr.hasMoreElements()) {
          InetAddress inetAddress = (InetAddress) enumIpAddr.nextElement();
          if (!inetAddress.isLoopbackAddress() && (inetAddress instanceof Inet4Address)) {
            return inetAddress.getHostAddress();
          }
        }
      }
    } catch (SocketException ex) {
      Log.e("ServerActivity", ex.toString());
    }
    return null;
  }

  @SuppressLint("WifiManagerLeak")
  public boolean isWiFiEnabled() {
    return ((WifiManager) BaseApplication.getContext().getSystemService(Context.WIFI_SERVICE)).isWifiEnabled();
  }

  public static final String DEVICE_TYPE = "AudioBroadCastDevice";
  public static final UDN AUDIO_BROADCAST_UDN = UDN.uniqueSystemIdentifier("AudioBroadCast");
  public static final String SERVICE_TYPE = "AudioBroadCast";

  public static String CONNECTED_TO_ADDRESS = null;
  public static int CONNECTED_TO_PORT = 0;
  public static String CONNECTED_TO_SERVERNAME = "";

  public static int RECORDER_AUDIO_ENCODING = AudioFormat.ENCODING_PCM_16BIT;
  public static int RECORDER_CHANNELS = AudioFormat.CHANNEL_CONFIGURATION_MONO;

//  public static int RECORDER_CHANNELS = AudioFormat.CHANNEL_IN_MONO;
//  public static int RECORDER_SAMPLERATE = 11025;
  public static int RECORDER_SAMPLERATE = 8000;

  public static String SERVER_ADDRESS = null;
  public static int SERVER_PORT = 0;
  public static volatile boolean isListening = false;
  public static volatile boolean isSpeaking = false;
  public static volatile List<ClientDetails> connectedClients = new ArrayList();
  public static volatile List<String> connectedUsers = new ArrayList();
  public static boolean isHeadSet() {
    AudioManager audioManager = (AudioManager) BaseApplication.getContext().getSystemService(Context.AUDIO_SERVICE);
    Log.println(Log.ASSERT, "WiredHeadsetOn = ", "aa" + audioManager.isWiredHeadsetOn());
    Log.i("MusicActive = ", audioManager.isMusicActive() + "");
    Log.i("SpeakerphoneOn = ", audioManager.isSpeakerphoneOn() + "");
    return audioManager.isWiredHeadsetOn();
  }
  public static final String NOTIFICATION_TEXT_WAITING_FOR_LISTENERS = "Waiting for clients...";
}
